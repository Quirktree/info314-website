<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Clinton Campbell">
        <link rel="canonical" href="https://info314.tcpip.dev/resources/setup-wireguard/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Install and Configure WireGuard - INFO 314 Course Resources</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/color-brewer.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">INFO 314 Course Resources</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">1 - Pi Setup</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/pi-setup/" class="dropdown-item">Raspberry Pi Setup</a>
</li>
            
<li>
    <a href="../../assignments/networkd-setup/" class="dropdown-item">networkd Setup</a>
</li>
            
<li>
    <a href="../wifi-reference/" class="dropdown-item">Wireless Configuration Reference</a>
</li>
            
<li>
    <a href="../uw-wireless/" class="dropdown-item">UW Wireless Reference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2 - Set up a DHCP Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../address-planning/" class="dropdown-item">IP Address Planning Reference</a>
</li>
            
<li>
    <a href="../../assignments/dhcp-setup/" class="dropdown-item">Installing and Configuring the ISC DHCP Server</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">3 - Configure Routing and NAT</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/router-setup/" class="dropdown-item">Router Setup</a>
</li>
            
<li>
    <a href="../nftables/" class="dropdown-item">Introduction to nftables</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">4 - Configure a DNS Resolver</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/resolver-setup/" class="dropdown-item">DNS Resolver Setup</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Report - NAT and DNS Analysis</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/analysis-report/" class="dropdown-item">Instructions</a>
</li>
            
<li>
    <a href="../tshark-install/" class="dropdown-item">Installing TShark</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">5 - Configure an Authoritative Name Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/dns-zone-setup/" class="dropdown-item">Authoritative Zone Setup</a>
</li>
            
<li>
    <a href="../zone-file-format/" class="dropdown-item">DNS Zone Reference</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../assignments/wireshark01/" class="dropdown-item">Lab 1 - Analyzing DHCP and ARP with Wireshark</a>
</li>
                                    
<li>
    <a href="../../assignments/wireshark02/" class="dropdown-item">Lab 2 - Analyze DNS & HTTP in Wireshark</a>
</li>
                                    
<li>
    <a href="../../assignments/wireshark03/" class="dropdown-item">Lab 3 - Analyze Zeroconf in Wireshark</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Getting Started</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../markdown/" class="dropdown-item">Intro to Markdown</a>
</li>
            
<li>
    <a href="../bash/" class="dropdown-item">Intro to Bash</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Concepts and Theory</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../notes/dns-overview/" class="dropdown-item">Domain Name System (DNS)</a>
</li>
            
<li>
    <a href="../../notes/router-overview/" class="dropdown-item">Routers</a>
</li>
            
<li>
    <a href="../../notes/ethernet-switches/" class="dropdown-item">Ethernet Switches</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Guides</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Common Tools</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../ssh-primer/" class="dropdown-item">Getting Started with SSH</a>
</li>
            
<li>
    <a href="../ssh-agent/" class="dropdown-item">Using ssh-agent</a>
</li>
            
<li>
    <a href="../wireshark-install/" class="dropdown-item">Install Wireshark</a>
</li>
            
<li>
    <a href="../tshark-install/" class="dropdown-item">Install TShark</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">DNS</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../zone-file-format/" class="dropdown-item">Zone File Reference</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Wireless</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../wifi-reference/" class="dropdown-item">Linux Wireless Configuration</a>
</li>
            
<li>
    <a href="../uw-wireless/" class="dropdown-item">UW Wireless Network Reference</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Iptables</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../iptables/" class="dropdown-item">Introduction to Iptables</a>
</li>
            
<li>
    <a href="../netfilter-hooks/" class="dropdown-item">Understanding Netfilter/Iptables Hooks</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Planning</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../address-planning/" class="dropdown-item">Basic IP Address Planning</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Routing and VPNs</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../setup-frr/" class="dropdown-item">Install Free Range Routing (FRR)</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Install and Configure WireGuard</a>
</li>
            
<li>
    <a href="../configure-routing-links/" class="dropdown-item">Configuring Routing Links</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Special Network Interfaces</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../loopback-interfaces/" class="dropdown-item">Loopback Interfaces</a>
</li>
            
<li>
    <a href="../dummy-interfaces/" class="dropdown-item">Dummy Interfaces</a>
</li>
            
<li>
    <a href="../vlan-interfaces/" class="dropdown-item">VLAN Interfaces</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">General</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../host-config/" class="dropdown-item">Mac/Win/Linux Networking</a>
</li>
            
<li>
    <a href="../manage-dhcp/" class="dropdown-item">Troubleshooting DHCP</a>
</li>
            
<li>
    <a href="../dns-clients/" class="dropdown-item">Managing DNS Clients</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../contact/" class="nav-link">Contact Us</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../setup-frr/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../configure-routing-links/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/quirktree/info314-website" class="nav-link">quirktree/info314-website</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#installing-and-configuring-wireguard-on-raspbian-and-debian-based-linux" class="nav-link">Installing and Configuring WireGuard on Raspbian and Debian-based Linux</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#before-you-begin" class="nav-link">Before you Begin</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#installing-wireguard" class="nav-link">Installing WireGuard</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#getting-started-with-wireguard" class="nav-link">Getting Started with WireGuard</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="installing-and-configuring-wireguard-on-raspbian-and-debian-based-linux">Installing and Configuring WireGuard on Raspbian and Debian-based Linux<a class="headerlink" href="#installing-and-configuring-wireguard-on-raspbian-and-debian-based-linux" title="Permanent link">&para;</a></h1>
<h2 id="before-you-begin">Before you Begin<a class="headerlink" href="#before-you-begin" title="Permanent link">&para;</a></h2>
<p>These instructions will aide you with installation of WireGuard on Raspbian/Debian Buster. They have been tested on the February 2020 release of Raspbian Buster and on a Debian 10.3 droplet on DigitalOcean. Instructions may differ for other distributions or releases.</p>
<h2 id="installing-wireguard">Installing WireGuard<a class="headerlink" href="#installing-wireguard" title="Permanent link">&para;</a></h2>
<h3 id="locating-an-installation-package">Locating an Installation Package<a class="headerlink" href="#locating-an-installation-package" title="Permanent link">&para;</a></h3>
<p>While WireGuard support has been added to recent versions of the Linux Kernel, this milestone was not reached until after the Debian and Raspbian teams had frozen features for Buster.</p>
<p>At the time this guide was written, the WireGuard application and kernel module were not yet available in the mainline Debian and Raspbian package repositories. However, we can obtain these components from Debian's backport repository for Buster, a collection of new and updated software compiled for Buster.</p>
<p>Depending on your installation, <em>buster-backports</em> may already be listed as a valid software source. We found this to be the case for Debian 10.3 on DigitalOcean, though on Raspbian, we needed to manually add <em>buster-backports</em> as a new source and import the signing keys used to verify the integrity of software installed from the repositories. </p>
<h4 id="check-existing-package-sources">Check Existing Package Sources<a class="headerlink" href="#check-existing-package-sources" title="Permanent link">&para;</a></h4>
<p>Before you proceed, determine whether manual configuration of backports is necessary:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Search existing apt package source locations</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>apt-cache policy <span class="p">|</span> grep buster-backports
</code></pre></div>
<h4 id="manually-configure-backports">Manually Configure Backports<a class="headerlink" href="#manually-configure-backports" title="Permanent link">&para;</a></h4>
<p>After completing the following steps, <em>apt</em> operations will consider packages from the backports repository while still preferring stable software versions from the mainline repository when available.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Import the PGP/GPG signing keys for buster-backports from a key server</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 04EE7237B7D453EC 648ACFD622F3D138
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># Add the backports repositories to the apt configuration</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nb">echo</span> <span class="s2">&quot;deb http://deb.debian.org/debian/ buster-backports main  contrib non-free&quot;</span> <span class="p">|</span> sudo tee -a /etc/apt/sources.list.d/debian-backports.list
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># Update the local software catalog via apt</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>sudo apt update
</code></pre></div>
<h3 id="install-linux-kernel-headers">Install Linux Kernel Headers<a class="headerlink" href="#install-linux-kernel-headers" title="Permanent link">&para;</a></h3>
<p>The WireGuard package in backports repository attempts to compile a kernel module in order to add WireGuard networking capabilities. To complete this task, the compiler must have access to kernel headers, a set of files that define the interface of kernel functions and data structures.</p>
<p>The kernel headers are available as a package and accessible via <em>apt</em>. Installation depends on your chosen distribution:</p>
<h4 id="installing-kernel-headers-for-raspbian">Installing Kernel Headers for Raspbian<a class="headerlink" href="#installing-kernel-headers-for-raspbian" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo apt install raspberrypi-kernel-headers
</code></pre></div>
<h4 id="installing-kernel-headers-for-debian">Installing Kernel Headers for Debian<a class="headerlink" href="#installing-kernel-headers-for-debian" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># `uname -r` is used to specify the proper kernel version</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>sudo apt install linux-headers-<span class="k">$(</span>uname -r<span class="k">)</span>
</code></pre></div>
<h3 id="install-wireguard-and-the-dkms-based-module">Install WireGuard and the DKMS-based module<a class="headerlink" href="#install-wireguard-and-the-dkms-based-module" title="Permanent link">&para;</a></h3>
<p>Finally, with the pre-requisites in place, we can use <em>apt</em> to install WireGuard and all of its supporting components. Once installed, you can use <em>modprobe</em> as shown below to verify that it the WireGuard kernel module is recognized by the kernel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Install</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo apt install wireguard wireguard-dkms
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># Verify (should return without any output/error)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>sudo modprobe wireguard
</code></pre></div>
<h2 id="getting-started-with-wireguard">Getting Started with WireGuard<a class="headerlink" href="#getting-started-with-wireguard" title="Permanent link">&para;</a></h2>
<p>The aim of the WireGuard project is to provide a fast and simple VPN that relies on rock-solid, modern cryptography. </p>
<h3 id="generate-a-wireguard-key-pair-for-each-server">Generate a WireGuard Key Pair for each Server<a class="headerlink" href="#generate-a-wireguard-key-pair-for-each-server" title="Permanent link">&para;</a></h3>
<p>Every node participating in a WireGuard VPN is required to have a private key for its own use and a public key that will be distributed to each of its peers. Before setting up our own VPN, we need to generate these keys on each server. </p>
<p>The following commands open a root-privileged shell in order to generate the keys. This extra step allows us to ensure proper file ownership and permissions via <em>umask</em> (which doesn't work smoothly with sudo)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Open a root shell</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>sudo bash
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Override default file creation permissions</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nb">umask</span> <span class="m">077</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># Create the public and private keys in /etc/wireguard</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>wg genkey <span class="p">|</span> tee -a /etc/wireguard/privatekey <span class="p">|</span> wg pubkey &gt; /etc/wireguard/publickey
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1"># Close the root shell</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="nb">exit</span>
</code></pre></div>
<p>After generating the keys for your servers, be sure to document the publickey for each endpoint. You’ll need it again in order to configure each of your VPN peers.</p>
<h3 id="identify-additional-parameters-for-your-vpn">Identify Additional Parameters for your VPN<a class="headerlink" href="#identify-additional-parameters-for-your-vpn" title="Permanent link">&para;</a></h3>
<h4 id="endpoint-ip-and-ports">Endpoint IP and Ports<a class="headerlink" href="#endpoint-ip-and-ports" title="Permanent link">&para;</a></h4>
<p>The endpoint addresses of a WireGuard VPN are the external addresses that peers will use in order to initiate connections with one another and to forward the encrypted payloads (via UDP datagrams that fully encapsulate the traffic sent/received on a virtual network interface). Each endpoint of a WireGuard VPN can function as both client and server (hence the name peer), however, taking full advanatage of this capability requires that all endpoints have routeable addresses. </p>
<p>Due to NAT and/or firewall configurations, we may have endpoints that aren't directly reachable. WireGuard provides utilities to cope with this scenario, as long as at least one endpoint is able to receive incoming sessions from its peer(s).</p>
<p>As with all servers, a routeable peer must define a port on which it will listen for incoming messages. WireGuard does not provide a standard port configuration, so it is up to administrators to determine an appropriate UDP port for WireGuard server to listen.</p>
<p>Since we will be configuring multiple instances of WireGuard on our servers, we should pay close attention to which ports are in use so that we don't cause a collision between independent tunnel interfaces.</p>
<p>In the following examples, we will assume that we have one publicly routeable peer and one located behind a NAT. We'll use port 51820 to listen for connections on the routeable peer.</p>
<h4 id="tunnel-ip-addresses">Tunnel IP addresses<a class="headerlink" href="#tunnel-ip-addresses" title="Permanent link">&para;</a></h4>
<p>WireGuard VPN connections are presented at the OS level as layer-3 network interfaces and will be configured with their own IP subnet/address settings. The main constraint is that these addresses are not part of any other subnet connected to the same device. For example, if my LAN is using 172.27.2.0/26 and my home network is 10.0.1.0/24, I cannot use anything from 172.27.2.0 - 63 or 10.0.1.0 - 255. I could, however, use addresses above 172.27.2.64. </p>
<p>The constraint above isn’t anything unique to WireGuard, we’re simply following the principle that you can’t route between networks with overlapping IP ranges (in the same way that we can’t give the same address to two nodes on the same network).</p>
<p>The following examples will define tunnel addresses of 10.99.0.2 and 10.99.0.3 for traffic sent inside the VPN.</p>
<h3 id="create-wireguard-interfaces">Create WireGuard Interfaces<a class="headerlink" href="#create-wireguard-interfaces" title="Permanent link">&para;</a></h3>
<p>In order to send and receive network traffic through a VPN, each peer is configured with a virtual network interface. Any traffic sent to this interface will be transported over the VPN tunnel. Incoming traffic will egress on this interface after being processed and decrypted by WireGuard.</p>
<p>The following examples demonstrate the use of the <em>ip</em> command to manually set up the virtual interface for WireGuard. You should be aware that any configuration you set up with this utility is not persistent. It will be reset after a reboot. Persistent WireGuard configuration will be covered separately.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a># Create the virtual interface
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>sudo ip link add dev wg0 type wireguard
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a># Assign a tunnel address to the interface (your second peer will reverse the order of these arguments)
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>sudo ip addr add dev wg0 10.99.0.2 peer 10.99.0.3
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a># Bring the interface online
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>sudo ip link set up dev wg0
</code></pre></div>
<h3 id="create-your-peers">Create your Peers<a class="headerlink" href="#create-your-peers" title="Permanent link">&para;</a></h3>
<p>Configure wireguard to use the new virtual interface to maintain a tunnel with its peer. As in the previous step, we’ll use the CLI interface to do this manually and come back later to add a persistent configuration.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a># Gather the public addresses for your peers (as applicable). You should have a public address for your DO peer, and you will need it to set up the Pi. Since the Pi is behind a NAT on your home network, we can&#39;t reach it directly with a public IPv4 address. As such, we&#39;ll always rely on the Pi to initiate the connection to Digital Ocean. I&#39;ll discuss implications of this later and how to deal with any limitations.
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a># The core command looks like `wg set &lt;INTERFACE&gt; listen-port &lt;PORT&gt; private-key &lt;PRIVATE KEY PATH&gt; peer &lt;PUBLIC KEY OF PEER&gt; allowed-ips &lt;List of CIDR IP ranges&gt; endpoint &lt;PUBLIC IP OF PEER&gt;:&lt;PORT&gt;`. 
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a># Raspberry Pi / no public IP to listen on (replace public key and address of DO endpoint)
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>sudo wg set wg0 private-key /etc/wireguard/privatekey peer ABCDEFG allowed-ips 0.0.0.0/0 endpoint A.B.C.D:51280
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a># DigitalOcean / has its own public IP to listen on but can&#39;t reach RPi directly
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>wg set wg0 listen-port 51280 private-key /etc/wireguard/privatekey peer ABCDEFG allowed-ips 0.0.0.0/0
</code></pre></div>
<p>Observe how we adjusted the command when one of the peers doesn’t have a routable public IP. The downside of this scenario is that the tunnel can only be initiated from one side of the link, and we won’t be able to receive inbound traffic until it’s open. We’ll come back to discuss how to set up a keep-alive so that the tunnel is always open. When we have the luxury of public IP addresses for both peers, we should aim to set up both ends to listen and to connect to the peer endpoint.</p>
<h3 id="test-your-tunnel">Test your Tunnel<a class="headerlink" href="#test-your-tunnel" title="Permanent link">&para;</a></h3>
<p>If everything has gone well to this point, make sure that you can ping each peer using its tunnel IP address. This may not seem like the most impressive feat , but we’ll quickly expand the functionality by adding the ability to forward traffic between other attached networks. In order to do this, we need to set up routes for each subnet and add iptables rules that allow traffic to be forwarded on our new interfaces.</p>
<p>If you’d like to experiment with this on your own, check out the ip route command in order to program static routes. Our upcoming tasks will focus on using dynamic routing to automate the route configuration for the entire class network (which will have more than 30 routers and subnets).</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Clinton Campbell</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
