<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Clinton Campbell">
        <link rel="canonical" href="https://info314.tcpip.dev/resources/ssh-agent/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Using ssh-agent - INFO 314 Course Resources</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/color-brewer.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">INFO 314 Course Resources</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">1 - Pi Setup</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../assignments/pi-setup/">Raspberry Pi Setup</a>
</li>
            
<li >
    <a href="../../assignments/networkd-setup/">networkd Setup</a>
</li>
            
<li >
    <a href="../wifi-reference/">Wifi Reference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">2 - Set up a DHCP Server</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../address-planning/">IP Address Planning Reference</a>
</li>
            
<li >
    <a href="../../assignments/dhcp-setup/">Installing and Configuring the ISC DHCP Server</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">3 - Configure Routing and NAT</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../assignments/router-setup/">Router Setup</a>
</li>
            
<li >
    <a href="../iptables/">Introduction to iptables</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../assignments/lab1/">Lab 1 - Core Technical Skills</a>
</li>
                                    
<li >
    <a href="../../assignments/lab2/">Lab 2 - Analyzing DHCP and ARP with Wireshark</a>
</li>
                                    
<li >
    <a href="../../assignments/lab3/">Lab 3 - Analyze Zeroconf in Wireshark</a>
</li>
                                    
<li >
    <a href="../../assignments/lab4/">Lab 4 - Analyze DNS & HTTP in Wireshark</a>
</li>
                                    
<li >
    <a href="../../assignments/lab5/">Lab 5 - Analyze TCP with ncat and Wireshark</a>
</li>
                                    
<li >
    <a href="../../assignments/lab6/">Lab 6 - Python and Socket Basics</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Concepts and Theory</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../notes/dns-overview/">Domain Name System (DNS)</a>
</li>
            
<li >
    <a href="../../notes/router-overview/">Routers</a>
</li>
            
<li >
    <a href="../../notes/ethernet-switches/">Ethernet Switches</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Guides</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../pi-materials/">Getting Pi Materials</a>
</li>
            
<li >
    <a href="../digital-ocean/">Digital Ocean Signup</a>
</li>
            
<li >
    <a href="../address-planning/">Basic IP Address Planning</a>
</li>
            
<li >
    <a href="../iptables/">Introduction to Iptables</a>
</li>
            
<li >
    <a href="../netfilter-hooks/">Understanding Netfilter/Iptables Hooks</a>
</li>
            
<li >
    <a href="../wifi-reference/">Linux Wireless Configuration</a>
</li>
            
<li >
    <a href="../zone-file-format/">Zone File Reference</a>
</li>
            
<li >
    <a href="../vlans-and-dummies/">Special Network Interfaces (VLANs and Dummies)</a>
</li>
            
<li >
    <a href="../configure-routing-links/">Configuring Routing Links</a>
</li>
            
<li >
    <a href="../setup-frr/">Install Free Range Routing (FRR)</a>
</li>
            
<li class="active">
    <a href="./">Using ssh-agent</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Quick Reference</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../markdown/">Intro to Markdown</a>
</li>
            
<li >
    <a href="../bash/">Intro to Bash</a>
</li>
            
<li >
    <a href="../host-config/">Mac/Win/Linux Networking</a>
</li>
            
<li >
    <a href="../wireshark-install/">Install Wireshark</a>
</li>
            
<li >
    <a href="../tshark-install/">Install TShark</a>
</li>
            
<li >
    <a href="../manage-dhcp/">Troubleshooting DHCP</a>
</li>
            
<li >
    <a href="../dns-clients/">Managing DNS Clients</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../contact/">Contact Us</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../setup-frr/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../markdown/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/quirktree/info314-website">quirktree/info314-website</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#using-the-ssh-agent-to-manage-login-keys">Using the SSH Agent to Manage Login Keys</a></li>
            <li><a href="#configuring-ssh-agent-for-macos">Configuring ssh-agent for macOS</a></li>
            <li><a href="#configuring-ssh-agent-for-windows-10">Configuring ssh-agent for Windows 10</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="using-the-ssh-agent-to-manage-login-keys">Using the SSH Agent to Manage Login Keys<a class="headerlink" href="#using-the-ssh-agent-to-manage-login-keys" title="Permanent link">&para;</a></h1>
<p>SSH keys can provide a notable improvement over password-based security (with
respect to certain threats), but they are not without inconvenience or risk.
Most notably, if we don't use encryption with strong passphrases to keys on 
disk, an intruder or piece of malware can more easily retrieve our keys and 
use them to access any resources we are permitted to access. Moreover, when we 
encrypt our private keys, we face the potential inconvenience of supplying the 
passphrase each time we run <code>ssh</code>.</p>
<p>To ease the burden of using keys in the proper manner, OpenSSH provides a 
helper service, i.e., <code>ssh-agent</code>, to help you manage your private keys. Once 
an identity has been added to the <code>ssh-agent</code>, the agent can use the private 
key to log into servers without requiring you to enter a password for the 
the server or supply the key's passphrase.</p>
<p>The <code>ssh-agent</code> helper is available for both macOS and Windows 10 (as well as 
Linux), but the configuration process varies for each system. By following 
the instructions provided in this guide when you first set up your private 
keys, you'll be able to take advantage of the security improvements offered 
by key-based SSH authentication with OpenSSH on your macOS or Windows 10 device.</p>
<h2 id="configuring-ssh-agent-for-macos">Configuring <code>ssh-agent</code> for macOS<a class="headerlink" href="#configuring-ssh-agent-for-macos" title="Permanent link">&para;</a></h2>
<ol>
<li>Configure OpenSSH to work with <code>ssh-agent</code> and macOS KeyChain</li>
<li>Launch the <code>ssh-agent</code> as a background service.</li>
<li>Use <code>ssh-add</code> to load your keys into the agent.</li>
</ol>
<h3 id="step-1">Step 1<a class="headerlink" href="#step-1" title="Permanent link">&para;</a></h3>
<p>Edit or create <code>~/.ssh/config</code> so that <code>ssh-agent</code> and macOS KeyChain are used automatically to manage private keys and passphrases. This configuration is required by the version of <code>ssh</code> distributed by Apple since macOS Sierra 10.12.2. </p>
<div class="codehilite"><pre><span></span>Host *
    AddKeysToAgent yes
    UseKeyChain yes
</pre></div>

<h3 id="step-2">Step 2<a class="headerlink" href="#step-2" title="Permanent link">&para;</a></h3>
<p>Launch the <code>ssh-agent</code> as a background service.
<div class="codehilite"><pre><span></span><span class="c1"># The eval $() syntax is used to update the current environment based on the output of the ssh-agent command</span>
$ <span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>ssh-agent -s<span class="k">)</span><span class="s2">&quot;</span>
</pre></div></p>
<p>Add your key to the <code>ssh-agent</code> using the <code>ssh-add</code> utility. </p>
<h3 id="step-3">Step 3<a class="headerlink" href="#step-3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># The -K option is required for some versions of macOS. Omit if it returns an error.</span>
ssh-add -K ~/.ssh/id_ed25519

<span class="c1"># Check that your key is loaded by listing current keys in the agent</span>
ssh-add -l
</pre></div>

<h2 id="configuring-ssh-agent-for-windows-10">Configuring <code>ssh-agent</code> for Windows 10<a class="headerlink" href="#configuring-ssh-agent-for-windows-10" title="Permanent link">&para;</a></h2>
<ol>
<li>Enable the <code>ssh-agent</code> Windows Service (disabled by default).</li>
<li>Configure Powershell to launch <code>ssh-agent</code> when you open a console.</li>
<li>Use <code>ssh-add</code> to load your keys into the agent.</li>
</ol>
<h3 id="step-1_1">Step 1<a class="headerlink" href="#step-1_1" title="Permanent link">&para;</a></h3>
<p>Launch Powershell with administrator privileges and set the startup mode for the <code>ssh-agent</code> service to <code>Manual</code> since it is configured by default as <code>Disabled</code>.</p>
<div class="codehilite"><pre><span></span><span class="nb">Set-Service</span> <span class="n">-Name</span> <span class="n">ssh-agent</span> <span class="n">-StartupType</span> <span class="n">Manual</span>
</pre></div>

<h3 id="step-2_1">Step 2<a class="headerlink" href="#step-2_1" title="Permanent link">&para;</a></h3>
<p>Open a normal (non-administrator) Powershell console and edit/create a profile script to automatically launch the <code>ssh-agent</code> service. </p>
<p>In order to do this, we need to enable the ability to run basic scripts on the system and then find the location of the script (automatically assigned by Windows to the <code>$PROFILE</code> variable).</p>
<div class="codehilite"><pre><span></span><span class="c"># Modify Powershell policy to allow basic powershell scripts to run</span>
<span class="nb">Set-ExecutionPolicy</span> <span class="n">-ExecutionPolicy</span> <span class="n">RemoteSigned</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>

<span class="c"># Test whether the profile script exists</span>
<span class="nb">Test-Path</span> <span class="nv">$PROFILE</span>

<span class="c"># If the previous command returns False, create the file</span>
<span class="nb">New-Item</span> <span class="n">-path</span> <span class="nv">$PROFILE</span> <span class="n">-type</span> <span class="n">file</span> <span class="n">-force</span>

<span class="c"># Launch Notepad.exe to create a script</span>
<span class="n">notepad</span><span class="p">.</span><span class="n">exe</span> <span class="nv">$PROFILE</span>
</pre></div>

<p>Use Notepad to add the following code to your profile script. This will be run each time you launch a new console.
<div class="codehilite"><pre><span></span><span class="c"># Launch the service if it&#39;s not already running</span>
<span class="nv">$agentService</span> <span class="p">=</span> <span class="nb">Get-Service</span> <span class="n">-Name</span> <span class="n">ssh-agent</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$agentService</span><span class="p">.</span><span class="n">Status</span> <span class="o">-ne</span> <span class="s2">&quot;Running&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">Start-Service</span> <span class="n">-Name</span> <span class="n">ssh-agent</span>
<span class="p">}</span>
</pre></div></p>
<h3 id="step-3_1">Step 3<a class="headerlink" href="#step-3_1" title="Permanent link">&para;</a></h3>
<p>Open a fresh Powershell console and add your keys to the agent.
<div class="codehilite"><pre><span></span><span class="c"># Add the private key to the ssh-agent</span>
<span class="n">ssh-add</span> <span class="nv">$HOME</span><span class="p">\.</span><span class="n">ssh</span><span class="p">\</span><span class="n">id_ed25519</span>

<span class="c"># Check that your key is loaded by listing current keys in the agent</span>
<span class="n">ssh-add</span> <span class="n">-l</span>
</pre></div></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Clinton Campbell</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
