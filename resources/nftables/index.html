
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation and Resources for INFO 314">
      
      
        <meta name="author" content="Clinton Campbell">
      
      
        <link rel="canonical" href="https://info314.tcpip.dev/resources/nftables/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.7">
    
    
      
        <title>Introduction to nftables - INFO 314 Course Resources</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction-to-netfilter-and-nftables-2022-04-02" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="INFO 314 Course Resources" class="md-header__button md-logo" aria-label="INFO 314 Course Resources" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            INFO 314 Course Resources
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introduction to nftables
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/quirktree/info314-website" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    quirktree/info314-website
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../assignments/pi-setup/" class="md-tabs__link">
        Projects
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../assignments/wireshark01/" class="md-tabs__link">
        Labs
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../markdown/" class="md-tabs__link md-tabs__link--active">
        Resources
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="INFO 314 Course Resources" class="md-nav__button md-logo" aria-label="INFO 314 Course Resources" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    INFO 314 Course Resources
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/quirktree/info314-website" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    quirktree/info314-website
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Projects
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Projects" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Projects
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          1 - Pi Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="1 - Pi Setup" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          1 - Pi Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/pi-setup/" class="md-nav__link">
        Raspberry Pi Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wifi-reference/" class="md-nav__link">
        Wireless Configuration Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../uw-wireless/" class="md-nav__link">
        UW Wireless Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/networkd-setup/" class="md-nav__link">
        networkd Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          2 - Set up a DHCP Server
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2 - Set up a DHCP Server" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          2 - Set up a DHCP Server
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../address-planning/" class="md-nav__link">
        IP Address Planning Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/dhcp-setup/" class="md-nav__link">
        Installing and Configuring the ISC DHCP Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          3 - Configure Routing and NAT
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="3 - Configure Routing and NAT" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          3 - Configure Routing and NAT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/router-setup/" class="md-nav__link">
        Router Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Introduction to nftables
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Introduction to nftables
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-nftables" class="md-nav__link">
    What is nftables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tables-chains-and-rule-syntax" class="md-nav__link">
    Tables, Chains, and Rule Syntax
  </a>
  
    <nav class="md-nav" aria-label="Tables, Chains, and Rule Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tables" class="md-nav__link">
    Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chains" class="md-nav__link">
    Chains
  </a>
  
    <nav class="md-nav" aria-label="Chains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-chains" class="md-nav__link">
    Base Chains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-syntax" class="md-nav__link">
    Rules Syntax
  </a>
  
    <nav class="md-nav" aria-label="Rules Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statements-actions" class="md-nav__link">
    Statements (actions)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expressions-conditions" class="md-nav__link">
    Expressions (conditions)
  </a>
  
    <nav class="md-nav" aria-label="Expressions (conditions)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-connection-state-in-rules" class="md-nav__link">
    Using Connection State in Rules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-policy-for-base-chains" class="md-nav__link">
    Default Policy (for Base Chains)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-nat-template" class="md-nav__link">
    Final NAT Template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-nftables" class="md-nav__link">
    Configuring nftables
  </a>
  
    <nav class="md-nav" aria-label="Configuring nftables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-the-nftables-service" class="md-nav__link">
    Enable the nftables Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#editing-nftable-rules-safely" class="md-nav__link">
    Editing nftable Rules Safely
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          4 - Configure a DNS Resolver
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="4 - Configure a DNS Resolver" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          4 - Configure a DNS Resolver
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/resolver-setup/" class="md-nav__link">
        DNS Resolver Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          Report - NAT and DNS Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Report - NAT and DNS Analysis" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Report - NAT and DNS Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/analysis-report/" class="md-nav__link">
        Instructions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tshark-install/" class="md-nav__link">
        Installing TShark
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          5 - Configure an Authoritative Name Server
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="5 - Configure an Authoritative Name Server" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          5 - Configure an Authoritative Name Server
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/dns-zone-setup/" class="md-nav__link">
        Authoritative Zone Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zone-file-format/" class="md-nav__link">
        DNS Zone Reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" type="checkbox" id="__nav_2_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7">
          Extra Credit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extra Credit" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Extra Credit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        VLAN Challenge
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Network Traffic Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Network Traffic Analysis" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Network Traffic Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/wireshark01/" class="md-nav__link">
        Analyze DHCP and ARP with Wireshark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/wireshark02/" class="md-nav__link">
        Analyze DNS & HTTP in Wireshark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/wireshark03/" class="md-nav__link">
        Analyze Zeroconf in Wireshark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/wireshark04/" class="md-nav__link">
        Analyze TCP with ncat and Wireshark
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Implement TLS 1.3 in Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Implement TLS 1.3 in Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Implement TLS 1.3 in Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/tls13/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/tls13-key-generation/" class="md-nav__link">
        Key Generation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../assignments/tls13-encrypt-decrypt.md" class="md-nav__link">
        Working with Encrypted TLS Records
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../markdown/" class="md-nav__link">
        Intro to Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bash/" class="md-nav__link">
        Intro to Bash
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Concepts and Theory
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concepts and Theory" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Concepts and Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../address-planning/" class="md-nav__link">
        Basic IP Address Planning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/dns-overview/" class="md-nav__link">
        Domain Name System (DNS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zone-file-format/" class="md-nav__link">
        DNS Zone Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/ethernet-switches/" class="md-nav__link">
        Ethernet Switches
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/router-overview/" class="md-nav__link">
        Routers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Core Settings and Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core Settings and Tools" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Core Settings and Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ssh-primer/" class="md-nav__link">
        Getting Started with SSH
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ssh-agent/" class="md-nav__link">
        Using the SSH Agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wireshark-install/" class="md-nav__link">
        Install Wireshark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tshark-install/" class="md-nav__link">
        Install TShark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../host-config/" class="md-nav__link">
        Mac/Win/Linux Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manage-dhcp/" class="md-nav__link">
        Troubleshooting DHCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dns-clients/" class="md-nav__link">
        Managing DNS Clients
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          General Linux Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="General Linux Networking" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          General Linux Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4_1" type="checkbox" id="__nav_4_4_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4_1">
          Firewalls
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Firewalls" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_4_1">
          <span class="md-nav__icon md-icon"></span>
          Firewalls
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Introduction to nftables
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Introduction to nftables
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-nftables" class="md-nav__link">
    What is nftables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tables-chains-and-rule-syntax" class="md-nav__link">
    Tables, Chains, and Rule Syntax
  </a>
  
    <nav class="md-nav" aria-label="Tables, Chains, and Rule Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tables" class="md-nav__link">
    Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chains" class="md-nav__link">
    Chains
  </a>
  
    <nav class="md-nav" aria-label="Chains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-chains" class="md-nav__link">
    Base Chains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-syntax" class="md-nav__link">
    Rules Syntax
  </a>
  
    <nav class="md-nav" aria-label="Rules Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statements-actions" class="md-nav__link">
    Statements (actions)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expressions-conditions" class="md-nav__link">
    Expressions (conditions)
  </a>
  
    <nav class="md-nav" aria-label="Expressions (conditions)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-connection-state-in-rules" class="md-nav__link">
    Using Connection State in Rules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-policy-for-base-chains" class="md-nav__link">
    Default Policy (for Base Chains)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-nat-template" class="md-nav__link">
    Final NAT Template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-nftables" class="md-nav__link">
    Configuring nftables
  </a>
  
    <nav class="md-nav" aria-label="Configuring nftables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-the-nftables-service" class="md-nav__link">
    Enable the nftables Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#editing-nftable-rules-safely" class="md-nav__link">
    Editing nftable Rules Safely
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../netfilter-hooks/" class="md-nav__link">
        Understanding netfilter Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables/" class="md-nav__link">
        Introduction to iptables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4_2" type="checkbox" id="__nav_4_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4_2">
          Network Interfaces
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Network Interfaces" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_4_2">
          <span class="md-nav__icon md-icon"></span>
          Network Interfaces
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../loopback-interfaces/" class="md-nav__link">
        Loopback Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dummy-interfaces/" class="md-nav__link">
        Dummy Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vlan-interfaces/" class="md-nav__link">
        VLAN Interfaces
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4_3" type="checkbox" id="__nav_4_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4_3">
          Virtual Private Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Virtual Private Networking" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_4_3">
          <span class="md-nav__icon md-icon"></span>
          Virtual Private Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-wireguard/" class="md-nav__link">
        Install and Configure WireGuard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4_4" type="checkbox" id="__nav_4_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4_4">
          Wireless
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wireless" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_4_4">
          <span class="md-nav__icon md-icon"></span>
          Wireless
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wifi-reference/" class="md-nav__link">
        wpa_supplicant Reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_5">
          Free Range Routing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Free Range Routing" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Free Range Routing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-frr/" class="md-nav__link">
        Install Free Range Routing (FRR)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configure-routing-links/" class="md-nav__link">
        Configuring Routing Links
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" type="checkbox" id="__nav_4_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_6">
          University of Washington Networks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="University of Washington Networks" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          University of Washington Networks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../uw-wireless/" class="md-nav__link">
        UW Wireless Network Reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-nftables" class="md-nav__link">
    What is nftables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tables-chains-and-rule-syntax" class="md-nav__link">
    Tables, Chains, and Rule Syntax
  </a>
  
    <nav class="md-nav" aria-label="Tables, Chains, and Rule Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tables" class="md-nav__link">
    Tables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chains" class="md-nav__link">
    Chains
  </a>
  
    <nav class="md-nav" aria-label="Chains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-chains" class="md-nav__link">
    Base Chains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-syntax" class="md-nav__link">
    Rules Syntax
  </a>
  
    <nav class="md-nav" aria-label="Rules Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statements-actions" class="md-nav__link">
    Statements (actions)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expressions-conditions" class="md-nav__link">
    Expressions (conditions)
  </a>
  
    <nav class="md-nav" aria-label="Expressions (conditions)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-connection-state-in-rules" class="md-nav__link">
    Using Connection State in Rules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-policy-for-base-chains" class="md-nav__link">
    Default Policy (for Base Chains)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-nat-template" class="md-nav__link">
    Final NAT Template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-nftables" class="md-nav__link">
    Configuring nftables
  </a>
  
    <nav class="md-nav" aria-label="Configuring nftables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-the-nftables-service" class="md-nav__link">
    Enable the nftables Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#editing-nftable-rules-safely" class="md-nav__link">
    Editing nftable Rules Safely
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="introduction-to-netfilter-and-nftables-2022-04-02">Introduction to netfilter and nftables (2022-04-02)<a class="headerlink" href="#introduction-to-netfilter-and-nftables-2022-04-02" title="Permanent link">&para;</a></h1>
<p>This guide introduces nftables by building a basic ruleset that allows us to safely forward packets between internal and external networks while also masquerading traffic with the IP address of the external network interface. </p>
<p><em>Read the entire guide carefully before attempting to install the template or any of the other tools referenced here</em>.</p>
<h2 id="what-is-nftables">What is nftables<a class="headerlink" href="#what-is-nftables" title="Permanent link">&para;</a></h2>
<p><em>nftables</em> is the default tool used to manage netfilter's <em>packet filter rules</em> in Raspberry Pi OS. Though <em>nftables</em> was originally released in 2014, it did not make its way into Raspberry Pi OS until the Bullseye release in November 2021. <em>nftables</em> is the successor to <em>iptables</em>, which has been in use within the Linux community for more than 20 years.</p>
<p><em>nftables</em> is a packet filtering framework included in a variety of modern Linux implementations. <em>Packet filtering</em> is a powerful technique that enables administrators to analyze and control the flow of inbound and outbound network traffic from any endpoint or intermediate network node. This level of control is essential for host- and network-based firewalls, network address translation (NAT), and other applications.</p>
<p>Packet filters define rules to match traffic based primarily on Layer 2 - 4 properties, such as: the inbound or outbound interface, type and length of messages, addresses, ports, and connection state. Each filter also describes actions taken when a match is found, e.g., log, deliver, or drop the packet. netfilter-based packet filters can also be used to apply NAT, make decisions about Quality of Service, or to reroute packets mid-flight.</p>
<p><em>nftables</em> builds on <em>netfilter</em>, an open-source project adding hooks, connection tracking, and other capabilities to the Linux network stack. These components enable dynamic filters, like <em>nftables</em> rules, to be applied to every packet traversing the network stack. They are the secret sauce to many of the applications described above. </p>
<h2 id="tables-chains-and-rule-syntax">Tables, Chains, and Rule Syntax<a class="headerlink" href="#tables-chains-and-rule-syntax" title="Permanent link">&para;</a></h2>
<p>In <em>nftables</em>, rules are composed of <em>expressions</em> that are used to select packets and <em>statements</em> that determine what actions <em>netfilter</em> will perform when a match occurs. While rules are the meat of our filter configurations, <em>nftables</em> doesn't allow them to stand alone. And so, before we explore the rule syntax, we need to looks <em>tables</em> and <em>chains</em>. </p>
<h3 id="tables">Tables<a class="headerlink" href="#tables" title="Permanent link">&para;</a></h3>
<p><em>nftables</em> uses a basic structure known as a <em>table</em> to organize rules. Each <em>table</em> is associated with a single <em>address family</em> and includes rules to apply to packets of that family. </p>
<p>This guide is focused on layer-3 traffic and considers tables for the following three address families:</p>
<ul>
<li><code>ip</code>: for IPv4 rules (default)</li>
<li><code>ip6</code>: for IPv6 rules</li>
<li><code>inet</code>: for rules that apply to both IPv4 and IPv6 packets</li>
</ul>
<p>While its predecessor, <em>iptables</em>, included a default set of tables for common packet filter functionality, <em>nftables</em> administrators are left to define their own tables. For this exercise, we'll create an IPv4 <code>nat</code> table to implement <em>address translation</em> between private and public addresses and an IPv4/IPv6 <code>filter</code> table to protect the Pi and the rest of our LAN from malicious traffic.<sup id="fnref:table_names"><a class="footnote-ref" href="#fn:table_names">1</a></sup></p>
<div class="admonition example">
<p class="admonition-title">Example: Empty <em>filter</em> and <em>nat</em> tables</p>
<div class="annotate highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="l l-Scalar l-Scalar-Plain">table inet filter {</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># Define chains (and rules) for IPv4 or IPv6 packets</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="l l-Scalar l-Scalar-Plain">table ip nat {</span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># Define chains (and rules) for IPv4 packets</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div>
</div>
<h3 id="chains">Chains<a class="headerlink" href="#chains" title="Permanent link">&para;</a></h3>
<p>Within each table, rules are grouped in <em>chains</em>. A <em>chain</em> is an ordered list of rules describing the packets to match and the action to take when a match is found. When a chain is processed, the rules in it are tested in order from the beginning until a match is found. If <em>nftables</em> finds a match while evaluating a rule, the remaining rules in that chain may be skipped depending on what action is taken.</p>
<h4 id="base-chains">Base Chains<a class="headerlink" href="#base-chains" title="Permanent link">&para;</a></h4>
<p><em>nftables</em> won't evaluate the rules in a chain automatically. Rather, a chain will only be processed if it is explicitly called from a rule in another chain or if the chain has been associated with a <a href="/resources/netfilter-hooks"><em>netfilter hook</em></a>.A chain that is associated with a hook is called a <em>base chain</em>.</p>
<p>Within the <code>filter</code> table, we are going to work with three base chains named <code>input</code>, <code>output</code>, and <code>forward</code>. These chains will be associated with <em>filter</em> hooks of the same names<sup id="fnref:chain_names"><a class="footnote-ref" href="#fn:chain_names">2</a></sup>, causing them to be processed when packets are being sent to software running on the Pi (<code>input</code> hook), when packets are being sent out by software on the Pi (<code>output</code>) hook, or when packets are being routed by the Pi from one network to another (<code>forward</code> hook). </p>
<div class="admonition example">
<p class="admonition-title">Example: Filter table and empty base chains</p>
<div class="annotate highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="l l-Scalar l-Scalar-Plain">table inet filter {</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain input {</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook input priority 0;</span><span class="w"></span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># Rules are evaluated when a packet is intended for this host</span><span class="w"></span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain forward {</span><span class="w"></span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook forward priority 0;</span><span class="w"></span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># Rules are evaluated when an incoming packet will be forwarded by this host</span><span class="w"></span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain output {</span><span class="w"></span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook output priority 0;</span><span class="w"></span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># Rules are evaluated when a packet is being sent from this host</span><span class="w"></span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div>
</div>
<p>The <code>nat</code> table will have one base chain that is named for its respective <em>hook</em>, i.e., <code>postrouting</code>. Within netfilter, the postrouting hooks are the last ones to be processed when sending or forwarding a packet. As such, rules processed here can perform masquerading on the source IP addresses.<sup id="fnref:prerouting"><a class="footnote-ref" href="#fn:prerouting">3</a></sup></p>
<div class="admonition example">
<p class="admonition-title">Example: NAT with postrouting base chain</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>table ip nat {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    chain postrouting {
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        type nat hook postrouting priority 100;
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        # Rules are evaluated after forwarding decisions in order to support source NAT or masquerading
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    }
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>}
</code></pre></div>
</div>
<h3 id="rules-syntax">Rules Syntax<a class="headerlink" href="#rules-syntax" title="Permanent link">&para;</a></h3>
<p>The basic <em>nftables</em> rule syntax includes an expression and a statement. Expressions define conditions that need to be satisfied before an action is applied to a packet. Statements define the actions that will be taken. Since actions are the simpler component of a rule, we'll begin our exploration there. </p>
<h4 id="statements-actions">Statements (actions)<a class="headerlink" href="#statements-actions" title="Permanent link">&para;</a></h4>
<p><em>nftables</em> statements are used to control packet flow, apply <em>NAT</em> transformations, compute metrics, record logs, and modify the order of rule evaluation. While the list below is not exhaustive, it is sufficient for this guide and the beginning firewall developer.</p>
<ul>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Accepting_and_dropping_packets"><code>accept</code></a>: Stop processing chain and deliver packet</li>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Accepting_and_dropping_packets"><code>drop</code></a>: Stop processing chain and drop packet</li>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Counters"><code>counter</code></a>: Increment byte and packet counters and continue processing chain</li>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Logging_traffic"><code>log</code></a>: Write information about packet to logs and continue processing chain</li>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_(NAT)#Masquerading"><code>masquerade</code></a>: Replace source IP address with the address of the output interface and stop processing chain</li>
</ul>
<p>You may observe that actions like <code>drop</code> and <code>accept</code> cause <em>nftables</em> to stop processing the current chain. These actions are known as terminal actions. Actions like <code>log</code> and <code>counter</code> are non-terminal because they allow <em>nftables</em> to continue processing even if a match had been found. <em>nftables</em> supports multiple actions in a single statement, but a terminal may only appear as the final component of a rule. </p>
<p>For example, we can produce a rule that increments a counter and delivers a packet by ending our rule with <code>counter accept</code>. We can also write a rule that increments a counter and logs a packet without specifying a policy decision by ending the rule with <code>counter log</code> or <code>log counter</code>. However, we cannot combine terminals or include a terminal before a non-terminal as with <code>accept counter</code> or <code>drop accept</code>.</p>
<h4 id="expressions-conditions">Expressions (conditions)<a class="headerlink" href="#expressions-conditions" title="Permanent link">&para;</a></h4>
<p>Our rules need to describe the packets we want to filter or manipulate. In this exercise, our <em>primary consideration</em> will be the <em>direction</em> in which a given packet is moving through the Pi. This is particularly of importance for routing decisions and NAT. We can describe our criteria by examining the ingress network for incoming packets and/or the egress network interface for outgoing packets. </p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Throughout the instructions, we'll refer to the internal interface as our <strong>&lt;LAN&gt;</strong> (because it serves our local network) and the external interface as the <strong>&lt;WAN&gt;</strong> (because it connects us to the Internet). Your configuration files will reflect the system assigned interface names, such as: <strong><code>eth0</code></strong> and <strong><code>wlan0</code></strong>.</p>
<p>It's up to you to determine, based on your learning so far, which interface corresponds to which placeholder.</p>
</div>
<p>Let's look at a rule that we can use to apply address translation to outbound packets. Since outbound packets will leave on the WAN, we can specify this restriction using the <em>outbound interface name (oifname)</em> condition, i.e., <code>oifname &lt;WAN&gt;</code>. The following example masquerades outbound traffic on the <strong>&lt;WAN&gt;</strong> interface.</p>
<div class="admonition example">
<p class="admonition-title">Example: Applying NAT transformation to outbound traffic</p>
<div class="annotate highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="l l-Scalar l-Scalar-Plain">table ip nat {</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain postrouting {</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type nat hook postrouting priority srcnat;</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">oifname &lt;WAN&gt; masquerade</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div>
</div>
<p>We can be even more specific with our rules by writing an expression with multiple conditionals. To identify outbound traffic forwarded from the LAN to the WAN, we can check both the inbound and outbound interface names by writing <code>iifname &lt;LAN&gt; oifname &lt;WAN&gt;</code>. The following example demonstrates a rule that explicitly accepts traffic flowing from <strong>&lt;LAN&gt;</strong> to <strong>&lt;WAN&gt;</strong>.</p>
<div class="admonition example">
<p class="admonition-title">Example: Combining multiple expressions</p>
<div class="annotate highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="l l-Scalar l-Scalar-Plain">table inet filter {</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain forward {</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook forward priority 0;</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">iifname &lt;LAN&gt; oifname &lt;WAN&gt; accept</span><span class="w"></span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div>
</div>
<h5 id="using-connection-state-in-rules">Using Connection State in Rules<a class="headerlink" href="#using-connection-state-in-rules" title="Permanent link">&para;</a></h5>
<p>Netfilter is a <em>stateful</em> filtering framework, meaning that it is even possible to specify nftables rules based on the state of a network connection for a given packet. This feature shapes our rules in two ways. </p>
<p>First, you'll notice that we only had to specify the masquerade rule in the egress direction. The same rule also handles the de-masquerading process for ingress packets. </p>
<p>Second, you'll see that we can base filtering decisions on connection state itself. While it's appropriate for NAT routers to allow outgoing traffic, we typically want to place restrict incoming traffic. When configuring a gateway connection for a home or office, we often block incoming traffic unless it relates to existing connections from the LAN. Unsolicited traffic does not make sense in this context and poses a security risk.</p>
<p>To accomplish this feat, we will make use of netfilter's connection tracking extensions and restrict incoming traffic to packets that are part of an established connection or related to a recent egress packet. The connection tracking portion of this expression is <code>ct state established,related</code>. </p>
<div class="admonition example">
<p class="admonition-title">Example: Using the connection tracking extension</p>
<div class="annotate highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">table inet filter {</span><span class="w"></span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">chain forward {</span><span class="w"></span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">type filter hook forward priority 0;</span><span class="w"></span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">iifname &lt;WAN&gt; ct state established,related accept</span><span class="w"></span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div>
</div>
<h4 id="default-policy-for-base-chains">Default Policy (for Base Chains)<a class="headerlink" href="#default-policy-for-base-chains" title="Permanent link">&para;</a></h4>
<p>We are missing one piece to complete our configuration. By default, <em>nftables</em> accepts a packet unless a match occurs on a terminal rule. Base chains can override this behavior by defining a default policy. We'll use this feature to create a firewall that fail securely, i.e., blocking traffic that we don't explicitly allow.</p>
<p>The following example adds a base chain policy in order to drop forwarded packets that we didn't allow from another rule.</p>
<div class="admonition example">
<p class="admonition-title">Example: Default drop policy</p>
<div class="annotate highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="l l-Scalar l-Scalar-Plain">table inet filter {</span><span class="w"></span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain forward {</span><span class="w"></span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook forward priority 0; policy drop;</span><span class="w"></span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># Explicitly allow &quot;safe&quot; connections</span><span class="w"></span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">iifname &lt;LAN&gt; oifname &lt;WAN&gt; accept</span><span class="w"></span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">iifname &lt;WAN&gt; ct state established,related accept</span><span class="w"></span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div>
</div>
<p>The <em>default deny</em> posture is a best practice for your networks and devices, but it's important to approach the strategy with care. Without additional rules, attaching <code>policy drop</code> to the <code>input</code> and <code>output</code> chains will block inbound and outbound SSH and other protocols that might be needed for remote management. We will come back to this in a later guide, but we recommend for now that you leave the default accept policy on these chains.</p>
<h3 id="final-nat-template">Final NAT Template<a class="headerlink" href="#final-nat-template" title="Permanent link">&para;</a></h3>
<p>The following template draws together all of the components we have discussed so far to define a basic NAT configuration for a Linux router, leaving placeholder<sup id="fnref:placeholder"><a class="footnote-ref" href="#fn:placeholder">4</a></sup>,<sup id="fnref:quoting"><a class="footnote-ref" href="#fn:quoting">5</a></sup> elements for the reader to complete. Please review the previous examples and specifications that have been given in order to create a valid configuration. The following section will help you test and install your new ruleset.</p>
<p>!!! info Routing / NAT template
    <div class="annotate highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Always flush the active ruleset before defining your new rules</span><span class="w"></span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="l l-Scalar l-Scalar-Plain">flush ruleset</span><span class="w"></span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="l l-Scalar l-Scalar-Plain">table inet filter {</span><span class="w"></span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain forward {</span><span class="w"></span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook &lt;HOOK&gt; priority 0; policy &lt;ACTION&gt;;</span><span class="w"></span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># Explicitly allow &quot;safe&quot; connections</span><span class="w"></span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">iifname &lt;LAN&gt; oifname &lt;WAN&gt; &lt;ACTION&gt;</span><span class="w"></span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">iifname &lt;WAN&gt; ct state established,related &lt;ACTION&gt;</span><span class="w"></span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain input {</span><span class="w"></span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook input priority 0;</span><span class="w"></span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># You may leave this chain empty for now</span><span class="w"></span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain output {</span><span class="w"></span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type filter hook output priority 0;</span><span class="w"></span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># You may leave this chain empty for now</span><span class="w"></span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="l l-Scalar l-Scalar-Plain">table ip nat {</span><span class="w"></span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">chain postrouting {</span><span class="w"></span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">type nat hook postrouting priority srcnat;</span><span class="w"></span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">oifname &lt;WAN&gt; masquerade</span><span class="w"></span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="l l-Scalar l-Scalar-Plain">}</span><span class="w"></span>
</code></pre></div></p>
<h2 id="configuring-nftables">Configuring nftables<a class="headerlink" href="#configuring-nftables" title="Permanent link">&para;</a></h2>
<p>Throughout this guide, <em>nftables</em> configuration has been presented in a declarative, table-based format that closely reflects the table/chain/rule hierarchy. <em>nftables</em> also supports a command-based syntax that is passed to the <em>nft</em> utility on the command line or from within scripts in order to create, read, update, and delete individual elements of a ruleset dynamically. </p>
<p>We generally want firewall and routing rules to be configured as soon as possible during the boot process. When the <em>nftables</em> service is started, <em>Raspberry Pi OS</em> will initialize it with the contents of <em>/etc/nftables.conf</em>. </p>
<p>While experimentation is usually encouraged, you may encounter negative consequences if you make haphazard modifications to this file. A <a href="#editing-nftable-rules-safely">simple script</a> is provided below to support the learning process by testing your ruleset before making changes permanent.</p>
<h3 id="enable-the-nftables-service">Enable the nftables Service<a class="headerlink" href="#enable-the-nftables-service" title="Permanent link">&para;</a></h3>
<p>The <em>nftables</em> service may not be running by default on your device. You can check on the current status of the daemon with <code>systemctl status nftables</code>. To launch the service immediately, run <code>systemctl start nftables</code>. To ensure that <em>nftables</em> also starts automatically at boot, run <code>systemctl enable nftables</code>. </p>
<h3 id="editing-nftable-rules-safely">Editing nftable Rules Safely<a class="headerlink" href="#editing-nftable-rules-safely" title="Permanent link">&para;</a></h3>
<div class="admonition danger">
<p class="admonition-title">Here be Dragons</p>
<p>Do not write rules directly to <code>/etc/nftables.conf</code>. Without proper testing, you risk creating a rule that locks you out of your device from the network.  </p>
</div>
<p>Create a working copy of <code>/etc/nftables.conf</code> into your <em>home directory</em> <em>(it is okay to rename the file)</em>. Open the new copy and ensure that <code>flush ruleset</code> near the top (before your table definitions).<sup id="fnref:flush"><a class="footnote-ref" href="#fn:flush">6</a></sup> Proceed with any modifications to the working copy.</p>
<p>To test your ruleset, we recommend a scripted approach that can automatically revert a change that locks you out of the Pi. INFO314 students can find a copy of <code>nftables-apply.sh</code> in the project repository or create the script from the following listing.</p>
<details class="info">
<summary>nftables-apply.sh</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>#!/bin/bash
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a># Adapted from https://sanjuroe.dev/nft-safe-reload (retrieved on 2022-04-03)
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a># Modified to avoid editing system rules in-place
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>SYSTEM_RULES=&quot;/etc/nftables.conf&quot;
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>TIMEOUT=45
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>saved_rules=$(mktemp)
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>cleanup() {
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    rm -f &quot;$saved_rules&quot;
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>}
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>trap &quot;cleanup&quot; EXIT;
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a># Waits $TIMEOUT seconds for a yes/no response
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>read_approval() {
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>        read -t $TIMEOUT response 2&gt; /dev/null
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>        case &quot;$response&quot; in
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>                y|Y)
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>                        return 0
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>                        ;;
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>                *)
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>                        return 1
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>                        ;;
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>        esac
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>}
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a># Make a copy of the active ruleset
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>backup() {
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>        printf &quot;flush ruleset\n&quot; &gt; $saved_rules
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>        nft list ruleset &gt;&gt; $saved_rules
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>}
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a># Apply a named ruleset
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>apply() {
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>        nft -f &quot;$1&quot;
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>}
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a># Update system ruleset
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>save() {
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>    local source_rules=&quot;$1&quot;
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>    cp --no-preserve=mode,ownership &quot;$source_rules&quot; &quot;$SYSTEM_RULES&quot;
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>}
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a># Make a backup of the active ruleset in case of rollback
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>backup
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>new_rules=&quot;$1&quot;
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>if apply &quot;$new_rules&quot;; then
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>    printf &quot;Are you still able to connect to your device (auto-rollback in $TIMEOUT seconds)? [y/n] &quot;
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>        if read_approval; then
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>        save &quot;$new_rules&quot;
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>                printf &quot;\nUpdated system ruleset at ${SYSTEM_RULES}\n&quot;
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>        exit 0
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>        else
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>                apply &quot;$saved_rules&quot;
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>        printf &quot;\nRolling back to original configuration\n&quot;
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>                exit 2
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>        fi
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>fi
</code></pre></div>
</details>
<p>To test your rules, pass the name of your new rules file to the <em>nftables-apply.sh</em> script, e.g., <code>./nftables-apply.sh nftables-test.conf</code>. If your rules load without any errors, you will be prompted to answer whether you can still connect. </p>
<p>Open an <em>additional</em> terminal window and launch SSH to connect to your Pi. If you are able to complete this step successfully, you can apply your changes to <code>/etc/nftables.conf</code> by answering <code>y</code> at the <em>nftables-apply</em> prompt in your original session. </p>
<p><img alt="Accept New Rules" src="/img/accept-nft-rules.png" /></p>
<p>If the test fails, answer <strong>n</strong> or wait 45 seconds for the rules to revert automatically.</p>
<p><img alt="Reject New Rules" src="/img/rollback-nft-rules.png" /></p>
<p>Once you are satisified that your rules are working correctly, it's a good idea to verify that your rules are loaded and that everything works correctly after a reboot. Use the <code>nft list ruleset</code> command to view active rules.</p>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="/resources/netfilter-hooks">Understanding Netfilter Hooks</a></li>
<li><a href="https://www.datapacket.com/blog/securing-your-server-with-nftables">Securing Your Server with nftables</a></li>
<li><a href="https://sanjuroe.dev/nft-safe-reload">Safe Reload with nftables</a></li>
<li><a href="https://www.oreilly.com/openbook/linag2/book/ch11.html">Linux Network Administrators Guide - Masquerading</a></li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:table_names">
<p>These names were chosen to mirror the built-in tables of <em>iptables</em>.&#160;<a class="footnote-backref" href="#fnref:table_names" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:chain_names">
<p>This naming convention is influenced by <em>iptables</em> and its built-in chains.&#160;<a class="footnote-backref" href="#fnref:chain_names" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:prerouting">
<p><em>netfilter</em> also defines a <code>prerouting</code> nat hook that executes before routing decisions and can be used to implement port-forwarding and other destination NAT configurations.&#160;<a class="footnote-backref" href="#fnref:prerouting" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:placeholder">
<p>Text surrounded by &lt;&gt; symbols is indicative of a placeholder that should be filled in before loading the ruleset.&#160;<a class="footnote-backref" href="#fnref:placeholder" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:quoting">
<p>Do not quote text substituted for placeholders unless quotes are shown in the template.&#160;<a class="footnote-backref" href="#fnref:quoting" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:flush">
<p><code>nft -f &lt;FILENAME&gt;</code> is additive by default. Including <code>flush ruleset</code> before your table/chain definitions ensures that the new ruleset is properly loaded.&#160;<a class="footnote-backref" href="#fnref:flush" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
</ol>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../dns-clients/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Managing DNS Clients" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Managing DNS Clients
            </div>
          </div>
        </a>
      
      
        
        <a href="../netfilter-hooks/" class="md-footer__link md-footer__link--next" aria-label="Next: Understanding netfilter Hooks" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Understanding netfilter Hooks
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Clinton Campbell
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.sections", "content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
    
  </body>
</html>