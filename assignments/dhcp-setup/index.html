<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Clinton Campbell">
        <link rel="canonical" href="https://info314.tcpip.dev/assignments/dhcp-setup/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Installing and Configuring the ISC DHCP Server - INFO 314 Course Resources</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/color-brewer.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">INFO 314 Course Resources</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">1 - Pi Setup</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../pi-setup/">Raspberry Pi Setup</a>
</li>
            
<li >
    <a href="../networkd-setup/">networkd Setup</a>
</li>
            
<li >
    <a href="../../resources/wifi-reference/">Wifi Reference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">2 - Set up a DHCP Server</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../resources/address-planning/">IP Address Planning Reference</a>
</li>
            
<li class="active">
    <a href="./">Installing and Configuring the ISC DHCP Server</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">3 - Configure Routing and NAT</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../router-setup/">Router Setup</a>
</li>
            
<li >
    <a href="../../resources/iptables/">Introduction to iptables</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../lab2/">Lab 2</a>
</li>
                                    
<li >
    <a href="../lab3/">Lab 3</a>
</li>
                                    
<li >
    <a href="../lab4/">Lab 4</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../resources/markdown/">Intro to Markdown</a>
</li>
                                    
<li >
    <a href="../../resources/bash/">Intro to Bash</a>
</li>
                                    
<li >
    <a href="../../resources/host-config/">Mac/Win/Linux Networking</a>
</li>
                                    
<li >
    <a href="../../resources/wireshark-install/">Install Wireshark</a>
</li>
                                    
<li >
    <a href="../../resources/wifi-reference/">Linux Wireless Reference</a>
</li>
                                    
<li >
    <a href="../../resources/manage-dhcp/">Troubleshooting DHCP</a>
</li>
                                    
<li >
    <a href="../../resources/dns-clients/">Managing DNS Clients</a>
</li>
                                    
<li >
    <a href="../../resources/iptables/">Introduction to iptables</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../resources/address-planning/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../router-setup/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/quirktree/info314-website">quirktree/info314-website</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#set-up-a-dhcp-server-for-your-lan-2020-01-22">Set up a DHCP Server for your LAN (2020-01-22)</a></li>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#before-you-start">Before you Start</a></li>
            <li><a href="#configure-static-addresses-for-your-raspberry-pi">Configure Static Addresses for your Raspberry Pi</a></li>
            <li><a href="#install-and-configure-dhcp">Install and Configure DHCP</a></li>
            <li><a href="#test-dhcp-server">Test DHCP Server</a></li>
            <li><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="set-up-a-dhcp-server-for-your-lan-2020-01-22">Set up a DHCP Server for your LAN (2020-01-22)<a class="headerlink" href="#set-up-a-dhcp-server-for-your-lan-2020-01-22" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>In this assignment, we'll be standing up a DHCP service on the Raspberry Pi. As we've discussed in class, DHCP is a function that is sometimes performed by routers and is a necessary service whenever we are creating a new network (of almost any type). </p>
<h2 id="before-you-start">Before you Start<a class="headerlink" href="#before-you-start" title="Permanent link">&para;</a></h2>
<p>Before starting any of the work within this checkpoint, make sure that you have completed all steps from checkpoint one, including the <strong>networkd</strong> setup.</p>
<p>You must also have completed the <strong>Address Planning Exercise</strong> correctly. You will use the parameters you selected in that exercise to configure the IP address for the Pi as well as the configuration for <strong>isc-dhcp-server</strong>.</p>
<h2 id="configure-static-addresses-for-your-raspberry-pi">Configure Static Addresses for your Raspberry Pi<a class="headerlink" href="#configure-static-addresses-for-your-raspberry-pi" title="Permanent link">&para;</a></h2>
<p>In this step, you will add a new configuration file to <strong>networkd</strong> in order to set up static addresses on <strong>eth0</strong>. The addresses you use here will be the one you defined for your <strong>DHCP Server</strong> and <strong>Default Gateway</strong> in the <strong>LAN Planning Exercise</strong>.</p>
<details class="danger"><summary>Please do not try to follow other tutorials for setting up addresses</summary><p>Every quarter, we have students who choose to follow online tutorials instead of the instructions we've provided. Please be aware that we are not using the default Raspberry Pi networking. These tutorials will often instruct you to configure static addresses in the <code>/etc/dhcpcd.conf</code> file or <code>/etc/network/interfaces</code>. Both of these methods were disabled when we set up <strong>networkd</strong>.</p>
</details>
<p>Create a file named <code>20-eth0.network</code> in  <code>/etc/systemd/network/</code> (you'll need to use <code>sudo</code>) and define a static configuration that includes your chosen IP address and CIDR range. This path should already contain a default configuration for ethernet interfaces, e.g., <code>99-eth.network</code>. We are overriding this configuration for <code>eth0</code> by naming the file in such a way that <strong>networkd</strong> will load it first and by ensuring that the configuration will match <code>eth0</code> exactly.</p>
<p>Your file should look something like:</p>
<div class="codehilite"><pre><span></span>[Match]
# We only want to match the eth0 interface
Name=eth0

# Provide full address config in abbreviated notation
[Network]
# Default Gateway / DHCP Server
Address=192.168.0.1/24


# Enable link local addresses for IPv6 (FE80::)
LinkLocalAddressing=ipv6
</pre></div>

<div class="admonition warning important">
<p class="admonition-title">Warning</p>
<p>Some online references will have you add a gateway and DNS settings for your new interface. You don't need to (and definitely shouldn't) add either to this interface. </p>
<p>This interface does not provide a path for Internet traffic, but your Pi will try to use it that way if it believes it can be used for a default route.</p>
<p>Likewise, we don't need to give the Pi DNS settings on Ethernet. The Pi will get it’s DNS from the wireless interface, which received it’s DNS settings from DHCP. </p>
</div>
<p>In order to test these new settings:</p>
<p>Call <code>sudo systemctl restart systemd-networkd.service</code> <strong>or</strong> reboot your Pi.</p>
<p>Once you log back in, verify that <code>networkd</code> is running by calling <code>systemctl status systemd-networkd</code> and use the <code>ip addr</code> command to check that <code>eth0</code> is online with the new address.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Make note that the Pi is now assigned to our new subnet, but our computer will still be using it's autoconfigured IPv4 address in the 169.254/16 range.</p>
<p>In an IPv4 only world, this would prevent us from talking to the Pi. To fix the problem, we'd have to manually configure a static IP on our laptop in the same range as the Pi's network ID.</p>
<p>Fortunately, both devices have autoconfigured IPv6 addresses that will be discovered through mDNS. By default, this is the address that SSH will use.</p>
</div>
<h2 id="install-and-configure-dhcp">Install and Configure DHCP<a class="headerlink" href="#install-and-configure-dhcp" title="Permanent link">&para;</a></h2>
<p>For this part of the exercise, we'll use the ISC DHCP Server. The ISC server is available in <code>apt</code> repositories, so it can be installed using:</p>
<div class="codehilite"><pre><span></span>sudo apt update
sudo apt install isc-dhcp-server
</pre></div>

<p>Edit <code>/etc/default/isc-dhcp-server</code> to specify the interfaces (<code>eth0</code> only) on which to run the DHCP server. Comment out any options pertaining to DHCP for IPv6.</p>
<p>The stock DHCP configuration is located at <code>/etc/dhcp/dhcpd.conf</code>. This file contains a number of example <code>subnet</code> declarations that you are meant to pick and choose from in order to configure the DHCP server and to distribute addresses within your predefined address range. For this assignment, our configuration is quite minimal:</p>
<div class="admonition instructions">
<p class="admonition-title">Specifications</p>
<p>Before you start to configure your subnet, comment out the lines near the top of the file that specify global settings for nameservers and domain (we won’t use them right now).</p>
<ul>
<li>Create a new subnet configuration block using the network ID and network mask you established in the <em>LAN Planning Exercise</em>.</li>
<li>Inside the subnet block, define a contiguous <code>range</code> of IP addresses for the DHCP pool out of the address range selected in the <em>LAN Planning Exercise</em>.</li>
<li>You may browse the othe options available, but at this point you should not specify anything other than the DHCP lease range.</li>
</ul>
</div>
<div class="admonition faq">
<p class="admonition-title">Why don't we configure the default gateway or name servers yet?</p>
<p>Students will frequently jump ahead and fill in additional network parameters. The reason we don't want to include these parameters yet is that our Pi is not yet ready to provide an Internet connection. Sending a default route back to your workstation will create a black hole of sorts for Internet traffic. Your computer will try to route the traffic through the Pi, and the Pi will simply drop everything it receives.</p>
</div>
<h2 id="test-dhcp-server">Test DHCP Server<a class="headerlink" href="#test-dhcp-server" title="Permanent link">&para;</a></h2>
<p>Use <code>systemctl</code> to restart the DHCP service as shown here:</p>
<p><code>sudo systemctl restart isc-dhcp-server.service</code></p>
<p>If you see errors such as the one shown here, you’ll need to continue troubleshooting the DHCP server (see next section).</p>
<div class="codehilite"><pre><span></span>pi@titan:~ $ sudo systemctl restart isc-dhcp-server.service
Job for isc-dhcp-server.service failed because the control process exited with error code.
See &quot;systemctl status isc-dhcp-server.service&quot; and &quot;journalctl -xe&quot; for details.
</pre></div>

<p>Check your local machine to confirm that an IP address in the specified network range was provided.</p>
<p>Try running <code>ping</code> from both directions (laptop -&gt; pi and pi -&gt; laptop) to confirm that the IP address and related settings are configured correctly.</p>
<div class="admonition warning important">
<p class="admonition-title">Warning</p>
<p>If you are on Windows, incoming <code>ping</code> requests (those from pi -&gt; laptop) will not get any response. This is because by default Windows Firewall blocks these requests from being answered. To disable this, run a PowerShell prompt as Administrator and enter these commands:
<div class="codehilite"><pre><span></span>New-NetFirewallRule -DisplayName &quot;Allow inbound ICMPv4&quot; -Direction Inbound -Protocol ICMPv4 -IcmpType 8 -Action Allow

New-NetFirewallRule -DisplayName &quot;Allow inbound ICMPv6&quot; -Direction Inbound -Protocol ICMPv6 -IcmpType 8 -Action Allow
</pre></div></p>
</div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<p>Troubleshooting for the ISC DHCP Server can be found under <a href="/resources/manage-dhcp/">troubleshooting dhcp</a>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Clinton Campbell</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
